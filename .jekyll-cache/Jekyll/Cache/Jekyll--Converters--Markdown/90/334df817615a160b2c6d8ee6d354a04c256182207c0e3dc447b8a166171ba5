I"+Á<p>å¥½ä¹…å¥½ä¹…æ²¡æœ‰æ›´æ–°ï¼Œæœ¬æ¥è¿™ç¯‡éšç¬”æ˜¯æƒ³åœ¨ä¹æœˆä»½å°±å†™çš„ï¼Œä½†å½“æ—¶è§‰å¾—è‡ªå·±è„‘å­å¾ˆå¥½ç”¨ï¼Œæ²¡å¿…è¦è®°å½•äº†ã€‚
ç„¶è€Œï¼Œä¸Šå‘¨è¢«æ‰“è„¸äº†ï¼ŒåŒæ ·çš„é”™è¯¯çŠ¯äº†ä¸¤æ¬¡ï¼Œå¿…é¡»æ›´æ–°äº†ï¼</p>

<h2 id="catagory">Catagory</h2>

<ol>
  <li><a href="#AsciiDoc">AsciiDoc</a></li>
  <li><a href="#ä¹¦å†™AsciiDocæ–‡æ¡£">ä¹¦å†™AsciiDocæ–‡æ¡£</a>
    <ol>
      <li><a href="#æ„é€ å‡½æ•°æ³¨å…¥çš„å¾ªç¯ä¾èµ–">æ„é€ å‡½æ•°æ³¨å…¥çš„å¾ªç¯ä¾èµ–</a></li>
      <li><a href="#setæ–¹å¼æ³¨å…¥çš„å¾ªç¯ä¾èµ–">setæ–¹å¼æ³¨å…¥çš„å¾ªç¯ä¾èµ–</a></li>
    </ol>
  </li>
</ol>

<hr />

<h2 id="asciidoc">AsciiDoc</h2>
<p>AsciiDocæ˜¯ä¸€ç§æ–‡æœ¬æ–‡æ¡£æ ¼å¼ï¼Œåœ¨å¦‚ä»Šè¿™å®¶å…¬å¸ï¼Œè¦æ±‚ç”¨AsciiDocæ¥ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼ˆåœ¨å‰ä¸€å®¶å…¬å¸ï¼Œæ¥å£æ–‡æ¡£éƒ½æ˜¯excelï¼Œemmmm)ã€‚ä¸ºä»€ä¹ˆä¸ç”¨Swaggerå‘¢ï¼Œå› ä¸ºSwaggerè¦å†™å¾ˆå¤šå‚æ•°æ ‡è®°ï¼Œæ¯”è¾ƒç¹çã€‚è€ŒAsciiDocçš„è¯ï¼Œåªæ˜¯æ­£å¸¸å†™ä»£ç æ³¨é‡Šå³å¯ã€‚æ¥ä¸‹æ¥æ¼”ç¤ºä¸€ä¸‹ï¼</p>

<hr />

<h2 id="ä¹¦å†™asciidocæ–‡æ¡£">ä¹¦å†™AsciiDocæ–‡æ¡£</h2>
<p>ï¼ˆå‰æï¼šä½ çš„ideaå®‰è£…äº†AsciiDocæ’ä»¶ï¼‰</p>

<p>é¦–å…ˆåœ¨é¡¹ç›®çš„build.gradleæ–‡ä»¶é‡Œæ·»åŠ å¦‚ä¸‹å†…å®¹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plugins {
    id 'org.asciidoctor.convert' version '2.4.0'
}

ext {
    snippetsDir = file('build/asciidoc')
}

(åœ¨dependenciesé‡Œæ·»åŠ ä¸¤ä¸ªä¾èµ–)
testCompile group: 'org.springframework.restdocs', name: 'spring-restdocs-core', version: '2.0.4.RELEASE'
testCompile group: 'org.springframework.restdocs', name: 'spring-restdocs-mockmvc', version: '2.0.4.RELEASE'

test {
    outputs.dir snippetsDir
    useJUnitPlatform()
}

asciidoctor {
    inputs.dir snippetsDir
    dependsOn test
}

task("docs", type: Jar) {
    dependsOn asciidoctor
    from("${asciidoctor.outputDir}/html5") {
        into 'static/docs'
    }
}


</code></pre></div></div>

<p>ç„¶ååœ¨é¡¹ç›®çš„srcç›®å½•ä¸‹ï¼Œå»ºç«‹docs/asciidocæ–‡ä»¶å¤¹ï¼Œåœ¨asciidocæ–‡ä»¶å¤¹ä¸‹æ–°å»ºindex.adocæ–‡ä»¶</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[[</span><span class="no">INDEX</span><span class="o">]]</span>
<span class="o">=</span> <span class="err">æ–‡ä»¶é¢„è§ˆæ¥å£æ–‡æ¡£</span>
<span class="o">:</span><span class="nl">author:</span> <span class="n">luqq</span>
<span class="o">:</span><span class="nl">revnumber:</span> <span class="n">v1</span><span class="o">.</span><span class="mi">0</span>
<span class="o">:</span><span class="nl">revdate:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">10</span>
<span class="o">:</span><span class="nl">toc:</span> <span class="n">left</span>
<span class="o">:</span><span class="n">toc</span><span class="o">-</span><span class="nl">title:</span> <span class="err">æœåŠ¡ç›®å½•</span>
<span class="o">:</span><span class="nl">icons:</span> <span class="n">font</span>
<span class="o">:</span><span class="n">source</span><span class="o">-</span><span class="nl">highlighter:</span> <span class="n">highlightjs</span>

<span class="o">:</span><span class="n">snippets</span><span class="o">-</span><span class="nl">dir:</span> <span class="o">../../../</span><span class="n">build</span><span class="o">/</span><span class="n">asciidoc</span>

<span class="o">[[</span><span class="nc">APIs</span><span class="o">]]</span>
<span class="o">==</span> <span class="err">æ–‡ä»¶é¢„è§ˆ</span>

<span class="nl">include:</span><span class="o">:</span><span class="n">previewFile</span><span class="o">.</span><span class="na">adoc</span><span class="o">[]</span>
</code></pre></div></div>
<p>ç„¶ååœ¨asciidocæ–‡ä»¶å¤¹ä¸‹æ–°å»ºpreviewFile.adocæ–‡ä»¶</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">:</span><span class="nl">path:</span> <span class="n">previewFile</span>

<span class="o">[[</span><span class="n">preview_file</span><span class="o">]]</span>
<span class="o">===</span> <span class="err">æ–‡ä»¶é¢„è§ˆ</span>

<span class="o">:</span><span class="n">snippets</span><span class="o">-</span><span class="nl">dir:</span> <span class="o">../../../</span><span class="n">build</span><span class="o">/</span><span class="n">asciidoc</span>

<span class="o">.</span><span class="na">curl</span> <span class="err">è°ƒç”¨æ–¹å¼</span>
<span class="nl">include:</span><span class="o">:{</span><span class="n">snippets</span><span class="o">-</span><span class="n">dir</span><span class="o">}/{</span><span class="n">path</span><span class="o">}/</span><span class="n">curl</span><span class="o">-</span><span class="n">request</span><span class="o">.</span><span class="na">adoc</span><span class="o">[]</span>
<span class="o">.</span><span class="na">http</span> <span class="n">request</span> <span class="n">RAW</span><span class="err">ç¤ºä¾‹ä¿¡æ¯</span>
<span class="nl">include:</span><span class="o">:{</span><span class="n">snippets</span><span class="o">-</span><span class="n">dir</span><span class="o">}/{</span><span class="n">path</span><span class="o">}/</span><span class="n">http</span><span class="o">-</span><span class="n">request</span><span class="o">.</span><span class="na">adoc</span><span class="o">[]</span>
<span class="o">.</span><span class="na">request</span> <span class="n">headers</span> <span class="err">è¯·æ±‚å¤´</span>
<span class="nl">include:</span><span class="o">:{</span><span class="n">snippets</span><span class="o">-</span><span class="n">dir</span><span class="o">}/{</span><span class="n">path</span><span class="o">}/</span><span class="n">request</span><span class="o">-</span><span class="n">headers</span><span class="o">.</span><span class="na">adoc</span><span class="o">[]</span>
<span class="o">.</span><span class="na">request</span> <span class="n">body</span> <span class="err">è¯·æ±‚å‚æ•°è¯´æ˜</span>
<span class="nl">include:</span><span class="o">:{</span><span class="n">snippets</span><span class="o">-</span><span class="n">dir</span><span class="o">}/{</span><span class="n">path</span><span class="o">}/</span><span class="n">request</span><span class="o">-</span><span class="n">fields</span><span class="o">.</span><span class="na">adoc</span><span class="o">[]</span>
<span class="o">.</span><span class="na">response</span> <span class="n">body</span> <span class="err">å“åº”</span><span class="n">payload</span>
<span class="nl">include:</span><span class="o">:{</span><span class="n">snippets</span><span class="o">-</span><span class="n">dir</span><span class="o">}/{</span><span class="n">path</span><span class="o">}/</span><span class="n">response</span><span class="o">-</span><span class="n">body</span><span class="o">.</span><span class="na">adoc</span><span class="o">[]</span>
<span class="o">.</span><span class="na">http</span> <span class="n">response</span> <span class="n">RAW</span><span class="err">ç¤ºä¾‹ä¿¡æ¯</span>
<span class="nl">include:</span><span class="o">:{</span><span class="n">snippets</span><span class="o">-</span><span class="n">dir</span><span class="o">}/{</span><span class="n">path</span><span class="o">}/</span><span class="n">http</span><span class="o">-</span><span class="n">response</span><span class="o">.</span><span class="na">adoc</span><span class="o">[]</span>
<span class="o">.</span><span class="na">response</span> <span class="err">å“åº”å‚æ•°è¯´æ˜</span>
<span class="nl">include:</span><span class="o">:{</span><span class="n">snippets</span><span class="o">-</span><span class="n">dir</span><span class="o">}/{</span><span class="n">path</span><span class="o">}/</span><span class="n">response</span><span class="o">-</span><span class="n">fields</span><span class="o">.</span><span class="na">adoc</span><span class="o">[]</span>
</code></pre></div></div>

<p>æ¥ä¸‹æ¥ï¼Œåœ¨é¡¹ç›®çš„testç›®å½•ä¸‹æ–°å»ºä¸¤ä¸ªTestç±»</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ai</span><span class="o">.</span><span class="na">preview</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ai.Application</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ai.spring.support.security.authorization.GatewayAuthenticationProcessingFilter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ai.spring.support.security.userdetails.AccountDetailsServiceImpl</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.After</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Before</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Rule</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.restdocs.JUnitRestDocumentation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.web.servlet.MockMvc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.web.servlet.setup.MockMvcBuilders</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.context.WebApplicationContext</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">mockmvc</span><span class="o">.</span><span class="na">MockMvcRestDocumentation</span><span class="o">.</span><span class="na">documentationConfiguration</span><span class="o">;</span>

<span class="cm">/**
 * @author lu
 * @date 2020/11/10
 */</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span><span class="o">(</span><span class="n">classes</span> <span class="o">=</span> <span class="nc">Application</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractBaseControllerTest</span> <span class="o">{</span>

    <span class="cm">/**
     * mockMvc
     */</span>
    <span class="kd">protected</span> <span class="nc">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">WebApplicationContext</span> <span class="n">context</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">protected</span> <span class="nc">ObjectMapper</span> <span class="n">objectMapper</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">AccountDetailsServiceImpl</span> <span class="n">accountDetailsService</span><span class="o">;</span>

    <span class="nd">@Rule</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="nc">JUnitRestDocumentation</span> <span class="n">restDocumentation</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JUnitRestDocumentation</span><span class="o">(</span><span class="s">"build/asciidoc"</span><span class="o">);</span>

    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">mockMvc</span> <span class="o">=</span> <span class="nc">MockMvcBuilders</span><span class="o">.</span><span class="na">webAppContextSetup</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">context</span><span class="o">)</span>
                <span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">documentationConfiguration</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">restDocumentation</span><span class="o">))</span>
                <span class="o">.</span><span class="na">addFilters</span><span class="o">(</span><span class="k">new</span> <span class="nc">GatewayAuthenticationProcessingFilter</span><span class="o">(</span><span class="n">accountDetailsService</span><span class="o">))</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@After</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">after</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ai</span><span class="o">.</span><span class="na">preview</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.MediaType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.restdocs.payload.JsonFieldType</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">headers</span><span class="o">.</span><span class="na">HeaderDocumentation</span><span class="o">.</span><span class="na">headerWithName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">headers</span><span class="o">.</span><span class="na">HeaderDocumentation</span><span class="o">.</span><span class="na">requestHeaders</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">mockmvc</span><span class="o">.</span><span class="na">MockMvcRestDocumentation</span><span class="o">.</span><span class="na">document</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">mockmvc</span><span class="o">.</span><span class="na">RestDocumentationRequestBuilders</span><span class="o">.</span><span class="na">post</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">payload</span><span class="o">.</span><span class="na">PayloadDocumentation</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">payload</span><span class="o">.</span><span class="na">PayloadDocumentation</span><span class="o">.</span><span class="na">subsectionWithPath</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">MockMvcResultHandlers</span><span class="o">.</span><span class="na">print</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">MockMvcResultMatchers</span><span class="o">.</span><span class="na">content</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">MockMvcResultMatchers</span><span class="o">.</span><span class="na">status</span><span class="o">;</span>

<span class="cm">/**
 * @author lu
 * @date 2020/11/10
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PreviewControllerTest</span> <span class="kd">extends</span> <span class="nc">AbstractBaseControllerTest</span><span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">preview</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">String</span> <span class="n">urlPath</span> <span class="o">=</span> <span class="s">"æ¥å£åç§°"</span><span class="o">;</span>
        <span class="c1">// æ„å»ºè¯·æ±‚ä½“</span>
        <span class="nc">PreviewTaskRequest</span> <span class="n">request</span> <span class="o">=</span>  <span class="nc">PreviewTaskRequest</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span>
                <span class="n">post</span><span class="o">(</span><span class="n">urlPath</span><span class="o">)</span>
                        <span class="c1">// å¦‚æœéœ€è¦header è¦å†™ä¸Š</span>
                        <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"XXX"</span><span class="o">,</span> <span class="s">"XXX"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">objectMapper</span><span class="o">.</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="n">request</span><span class="o">)))</span>
                <span class="o">.</span><span class="na">andDo</span><span class="o">(</span><span class="n">print</span><span class="o">())</span>
<span class="c1">//                .andExpect(status().isOk())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">content</span><span class="o">().</span><span class="na">contentType</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">))</span>
                <span class="c1">// è¿™é‡Œçš„previewFileè¦å’ŒpreviewFile.adocæ–‡ä»¶ä¸­çš„pathä¸€è‡´</span>
                <span class="o">.</span><span class="na">andDo</span><span class="o">(</span><span class="n">document</span><span class="o">(</span><span class="s">"previewFile"</span><span class="o">,</span>
                        <span class="c1">// å¦‚éœ€ï¼Œè¯·å†™ä¸Š</span>
                        <span class="n">requestHeaders</span><span class="o">(</span><span class="n">headerWithName</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"{token_type} {access_token}"</span><span class="o">)),</span>
                        <span class="n">relaxedRequestFields</span><span class="o">(</span>
                                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"requestParam1"</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"è¯·æ±‚å‚æ•°è§£é‡Š"</span><span class="o">),</span>
                                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"timeStamp"</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"æ—¶é—´æˆ³"</span><span class="o">)</span>
                        <span class="o">),</span>
                        <span class="n">relaxedResponseFields</span><span class="o">(</span>
                                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"resultCode"</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"å“åº”çŠ¶æ€ç  000000-æˆåŠŸ;å…¶å®ƒ-å¤±è´¥"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">),</span>
                                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"resultMessage"</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"å“åº”ç»“æœæè¿°"</span><span class="o">),</span>
                                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data"</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"å“åº”å¯¹è±¡"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">OBJECT</span><span class="o">).</span><span class="na">attributes</span><span class="o">().</span><span class="na">optional</span><span class="o">(),</span>
                                <span class="n">subsectionWithPath</span><span class="o">(</span><span class="s">"data.param1"</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"å“åº”å‚æ•°è§£é‡Š"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">optional</span><span class="o">(),</span>
                                <span class="n">subsectionWithPath</span><span class="o">(</span><span class="s">"data.status"</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"çŠ¶æ€"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">TYPE</span><span class="o">).</span><span class="na">optional</span><span class="o">(),</span>
                                <span class="n">subsectionWithPath</span><span class="o">(</span><span class="s">"data.message"</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"é™„åŠ ä¿¡æ¯"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">optional</span><span class="o">()</span>
                        <span class="o">))</span>
                <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>æ–°å»ºäº†éœ€è¦çš„æ–‡ä»¶ï¼Œç›®å½•æˆªå›¾å¦‚ä¸‹
<img src="/img/asciidoc/002.png" alt="ç›®å½•" title="ç›®å½•" /></p>

<p>æœ€åï¼Œåœ¨terminalä¸­æ‰§è¡Œgradle clean build docï¼Œå°±å¯ä»¥çœ‹åˆ°build/asciidoc/html5æ–‡ä»¶å¤¹äº†,html5æ–‡ä»¶å¤¹é‡Œçš„htmlå°±æ˜¯ç”Ÿæˆçš„æ¥å£æ–‡æ¡£ã€‚
<img src="/img/asciidoc/001.png" alt="ç›®å½•" title="ç›®å½•" /></p>

<p>åœ¨è¿™é‡Œæˆ‘åªæ˜¯æ‹¿ä¸€ä¸ªæ¥å£æ¥ä¸¾ä¾‹ã€‚æ­£å¸¸çš„é¡¹ç›®ä¸­ä¸æ­¢ä¸€ä¸ªæ¥å£çš„ï¼Œä½†æµç¨‹ä¸å˜ï¼Œå¤šä¸ªæ¥å£ï¼Œé‚£å°±æ˜¯åœ¨index.adocä¸­å¼•å…¥æ–°å»ºçš„adocï¼Œç„¶ååœ¨testç›®å½•ä¸‹æ–°å»ºæ¥å£æµ‹è¯•ç±»å³å¯ï¼</p>

<h3 id="æ„é€ å‡½æ•°æ³¨å…¥çš„å¾ªç¯ä¾èµ–">æ„é€ å‡½æ•°æ³¨å…¥çš„å¾ªç¯ä¾èµ–</h3>
<p>é¦–å…ˆï¼Œè¿™ç§æ–¹å¼æ˜¯ä¸å¯è¡Œçš„ï¼Œæ¥ä¸‹æ¥é€šè¿‡ä¾‹å­æ¥è·Ÿæºç è¿›è¡Œè°ƒè¯•ï¼Œè¯´æ˜ä¸ºä»€ä¹ˆä¸å¯ä»¥</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">deer</span><span class="o">.</span><span class="na">study</span><span class="o">.</span><span class="na">circleDependency</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="cm">/**
 * @author lu
 * @description
 * @date 2020-07-04
 */</span>

<span class="nd">@Component</span><span class="o">(</span><span class="s">"a"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>


    <span class="kd">private</span> <span class="no">B</span> <span class="n">b</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setB</span><span class="o">(</span><span class="no">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">A</span><span class="o">(</span><span class="no">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">deer</span><span class="o">.</span><span class="na">study</span><span class="o">.</span><span class="na">circleDependency</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="cm">/**
 * @author lu
 * @description
 * @date 2020-07-04
 */</span>

<span class="nd">@Component</span><span class="o">(</span><span class="s">"b"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">B</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="no">C</span> <span class="n">c</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setC</span><span class="o">(</span><span class="no">C</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">B</span><span class="o">(</span><span class="no">C</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">deer</span><span class="o">.</span><span class="na">study</span><span class="o">.</span><span class="na">circleDependency</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="cm">/**
 * @author lu
 * @description
 * @date 2020-07-04
 */</span>


<span class="nd">@Component</span><span class="o">(</span><span class="s">"c"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">C</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="no">A</span> <span class="n">a</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setA</span><span class="o">(</span><span class="no">A</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">C</span><span class="o">(</span><span class="no">A</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">deer</span><span class="o">.</span><span class="na">study</span><span class="o">.</span><span class="na">circleDependency</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="cm">/**
 * @author lu
 * @description
 * @date 2020-07-04
 */</span>
<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="s">"com.deer.study.circleDependency"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Config</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">deer</span><span class="o">.</span><span class="na">study</span><span class="o">.</span><span class="na">circleDependency</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="o">;</span>

<span class="cm">/**
 * @author lu
 * @description
 * @date 2020-07-04
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">AnnotationConfigApplicationContext</span> <span class="n">context</span><span class="o">=</span><span class="k">new</span> <span class="nc">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="nc">Config</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="no">A</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>
<p>ç¨‹åºçš„è¿è¡Œç»“æœæˆªå–éƒ¨åˆ†ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Caused</span> <span class="nl">by:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">beans</span><span class="o">.</span><span class="na">factory</span><span class="o">.</span><span class="na">BeanCurrentlyInCreationException</span><span class="o">:</span> <span class="nc">Error</span> <span class="n">creating</span> <span class="n">bean</span> <span class="n">with</span> <span class="n">name</span> <span class="sc">'a'</span><span class="o">:</span> <span class="nc">Requested</span> <span class="n">bean</span> <span class="n">is</span> <span class="n">currently</span> <span class="n">in</span> <span class="nl">creation:</span> <span class="nc">Is</span> <span class="n">there</span> <span class="n">an</span> <span class="n">unresolvable</span> <span class="n">circular</span> <span class="n">reference</span><span class="o">?</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">beans</span><span class="o">.</span><span class="na">factory</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">DefaultSingletonBeanRegistry</span><span class="o">.</span><span class="na">beforeSingletonCreation</span><span class="o">(</span><span class="nc">DefaultSingletonBeanRegistry</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">345</span><span class="o">)</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">beans</span><span class="o">.</span><span class="na">factory</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">DefaultSingletonBeanRegistry</span><span class="o">.</span><span class="na">getSingleton</span><span class="o">(</span><span class="nc">DefaultSingletonBeanRegistry</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">221</span><span class="o">)</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">beans</span><span class="o">.</span><span class="na">factory</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">AbstractBeanFactory</span><span class="o">.</span><span class="na">doGetBean</span><span class="o">(</span><span class="nc">AbstractBeanFactory</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">315</span><span class="o">)</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">beans</span><span class="o">.</span><span class="na">factory</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">AbstractBeanFactory</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">AbstractBeanFactory</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">199</span><span class="o">)</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">beans</span><span class="o">.</span><span class="na">factory</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">DependencyDescriptor</span><span class="o">.</span><span class="na">resolveCandidate</span><span class="o">(</span><span class="nc">DependencyDescriptor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">251</span><span class="o">)</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">beans</span><span class="o">.</span><span class="na">factory</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">DefaultListableBeanFactory</span><span class="o">.</span><span class="na">doResolveDependency</span><span class="o">(</span><span class="nc">DefaultListableBeanFactory</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1138</span><span class="o">)</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">beans</span><span class="o">.</span><span class="na">factory</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">DefaultListableBeanFactory</span><span class="o">.</span><span class="na">resolveDependency</span><span class="o">(</span><span class="nc">DefaultListableBeanFactory</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1065</span><span class="o">)</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">beans</span><span class="o">.</span><span class="na">factory</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ConstructorResolver</span><span class="o">.</span><span class="na">resolveAutowiredArgument</span><span class="o">(</span><span class="nc">ConstructorResolver</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">815</span><span class="o">)</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">beans</span><span class="o">.</span><span class="na">factory</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ConstructorResolver</span><span class="o">.</span><span class="na">createArgumentArray</span><span class="o">(</span><span class="nc">ConstructorResolver</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">721</span><span class="o">)</span>
	<span class="o">...</span> <span class="mi">42</span> <span class="n">more</span>
</code></pre></div></div>

<p>Springé¦–å…ˆå®ä¾‹åŒ–Aç±»ï¼Œåœ¨åˆå§‹åŒ–Aç±»çš„æ—¶å€™ï¼Œå‘ç°é€šè¿‡æ„é€ å‡½æ•°éœ€è¦Bç±»ï¼Œé‚£ä¹ˆSpringå»åˆå§‹åŒ–Bç±»ï¼Œå‘ç°éœ€è¦Cç±»ï¼Œ
é‚£ä¹ˆæ¥ç€å»åˆå§‹åŒ–Cç±»ï¼Œå‘ç°éœ€è¦Aç±»ï¼Œåˆ°è¿™é‡Œï¼Œåˆå»Springä¸­åŠ è½½Aç±»ï¼š
é‚£ä¹ˆæ¥ä¸‹æ¥é‡å¤´æˆæ¥äº†ï¼Œè·Ÿæºä»£ç è°ƒè¯•ï¼š</p>

<p><img src="/img/recursion/circular/circular2.png" alt="ä»£ç è°ƒè¯•" title="ä»£ç è°ƒè¯•" /></p>

<p><img src="/img/recursion/circular/circular3.png" alt="ä»£ç è°ƒè¯•" title="ä»£ç è°ƒè¯•" /></p>

<p><img src="/img/recursion/circular/circular4.png" alt="ä»£ç è°ƒè¯•" title="ä»£ç è°ƒè¯•" /></p>

<p><img src="/img/recursion/circular/circular5.png" alt="ä»£ç è°ƒè¯•" title="ä»£ç è°ƒè¯•" /></p>

<p><img src="/img/recursion/circular/circular6.png" alt="ä»£ç è°ƒè¯•" title="ä»£ç è°ƒè¯•" /></p>

<p>ç”±ä¸Šé¢çš„è°ƒè¯•è¿‡ç¨‹å¯çŸ¥ï¼Œå½“Cç±»è¯•å›¾åœ¨åŠ è½½Açš„æ—¶å€™ï¼Œç¨‹åºæŠ›å‡ºå¼‚å¸¸ã€‚é‚£ä¹ˆCæ— æ³•æˆåŠŸåˆ›å»ºï¼Œé‚£ä¹ˆä¾èµ–Cçš„Bï¼Œä¾èµ–Bçš„AåŒæ ·
æ— æ³•åˆ›å»ºã€‚æ‰€ä»¥æ„é€ å‡½æ•°æ³¨å…¥çš„å¾ªç¯ä¾èµ–æ˜¯æ— æ³•æˆåŠŸçš„ã€‚</p>

<h3 id="setæ–¹å¼æ³¨å…¥çš„å¾ªç¯ä¾èµ–">setæ–¹å¼æ³¨å…¥çš„å¾ªç¯ä¾èµ–</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">deer</span><span class="o">.</span><span class="na">study</span><span class="o">.</span><span class="na">circleDependency</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="cm">/**
 * @author lu
 * @description
 * @date 2020-07-04
 */</span>
<span class="nd">@Component</span><span class="o">(</span><span class="s">"d"</span><span class="o">)</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">D</span> <span class="o">{</span>


    <span class="no">E</span> <span class="n">e</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setE</span><span class="o">(</span><span class="no">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
    <span class="o">}</span>


<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">deer</span><span class="o">.</span><span class="na">study</span><span class="o">.</span><span class="na">circleDependency</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Scope</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="cm">/**
 * @author lu
 * @description
 * @date 2020-07-04
 */</span>
<span class="nd">@Component</span><span class="o">(</span><span class="s">"e"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">E</span> <span class="o">{</span>
    <span class="no">D</span> <span class="n">d</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setD</span><span class="o">(</span><span class="no">D</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">;</span>
    <span class="o">}</span>


<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">deer</span><span class="o">.</span><span class="na">study</span><span class="o">.</span><span class="na">circleDependency</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="o">;</span>

<span class="cm">/**
 * @author lu
 * @description
 * @date 2020-07-04
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">AnnotationConfigApplicationContext</span> <span class="n">context</span><span class="o">=</span><span class="k">new</span> <span class="nc">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="nc">Config</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="no">D</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š
<img src="/img/recursion/circular/circular11.png" alt="è¿è¡Œç»“æœ" title="è¿è¡Œç»“æœ" /></p>

<p>é€šè¿‡setæ–¹å¼æ³¨å…¥çš„å¾ªç¯ä¾èµ–ï¼Œå°±å¯ä»¥æˆåŠŸï¼ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ¥çœ‹è°ƒè¯•ï¼</p>

<p><img src="/img/recursion/circular/circular7.png" alt="ä»£ç è°ƒè¯•" title="ä»£ç è°ƒè¯•" /></p>

<p>ç”±ä¸Šé¢çš„è°ƒè¯•å¯çŸ¥ï¼ŒDä¾èµ–Eï¼ŒEä¾èµ–Dã€‚Dåœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œå»æ‰¾Eï¼Œé‚£ä¹ˆEå¼€å§‹åˆ›å»ºï¼ŒEåˆ›å»ºæ—¶å»æ‰¾åˆ°äº†Dã€‚é‚£ä¹ˆEåˆ›å»º
æˆåŠŸï¼Œéšä¹‹Dä¹Ÿåˆ›å»ºæˆåŠŸã€‚å› æ­¤ï¼Œsetæ–¹å¼æ³¨å…¥çš„å¾ªç¯ä¾èµ–æ˜¯å¯è¡Œçš„ã€‚</p>

<p>è§£ç­”ä¸€ä¸‹ä¸ºä»€ä¹ˆåœ¨æ„é€ å‡½æ•°æ³¨å…¥çš„å¾ªç¯ä¾èµ–ï¼ŒA-&gt;B-&gt;C-&gt;Aæ—¶çš„getSingleton(â€œaâ€)ä¸ºnullï¼Œè€Œsetæ–¹å¼çš„D-&gt;E-&gt;D
æ—¶çš„getSingleton(â€œdâ€)å°±å¯ä»¥è·å–åˆ°å¯¹è±¡å‘¢ï¼Ÿçœ‹ä»£ç ï¼</p>

<p><img src="/img/recursion/circular/circular8.png" alt="ä»£ç è°ƒè¯•" title="ä»£ç è°ƒè¯•" /></p>

<p><img src="/img/recursion/circular/circular9.png" alt="ä»£ç è°ƒè¯•" title="ä»£ç è°ƒè¯•" /></p>

<p>singletonObject = singletonFactory.getObject(); è¿™ä¸ªæ–¹æ³•ä»£è¡¨çš„æ„æ€æ˜¯ï¼šå¦‚æœå½“å‰beanå­˜åœ¨äºspringå®¹å™¨ä¸­ï¼Œ
é‚£ä¹ˆå°±ç›´æ¥è·å–ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±å»åˆ›å»ºè¿™ä¸ªbeanã€‚é‡å¤´æˆæ¥äº†ï¼å¦‚æœæ˜¯é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥çš„ï¼Œspringä¼šé€šè¿‡è¿™ä¸ªæœ‰å‚çš„
æ„é€ å‡½æ•°å»åˆ›å»ºbeanï¼Œç„¶è€Œå¦‚ä¸Šè°ƒè¯•è¿‡ç¨‹ï¼Œæ„é€ å‡½æ•°çš„å‚æ•°éƒ½è·å–ä¸åˆ°ï¼Œé‚£ä¹ˆåœ¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸æŠ¥é”™ï¼Œå› æ­¤åˆ›å»ºå¤±è´¥ã€‚é‚£ä¹ˆä»£ç ä¹Ÿå°±æ— æ³•å¾€ä¸‹ç»§ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ— æ³•æ‰§è¡Œåˆ°
addSingleton(beanName, singletonObject);è¿™ä¸ªæ–¹æ³•ã€‚åä¹‹ï¼Œå¦‚æœæ˜¯é€šè¿‡setæ–¹æ³•æ³¨å…¥çš„ï¼Œspringä¼šé€šè¿‡æ— å‚æ•°
æ„é€ å‡½æ•°å»å®ä¾‹åŒ–è¿™ä¸ªbeanï¼Œç¨‹åºå¯ä»¥é¡ºåˆ©æ‰§è¡Œï¼Œåˆ›å»ºäº†beanï¼Œèµ‹å€¼ç»™äº†singletonObjectï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ‰§è¡Œåˆ°
addSingleton(beanName, singletonObject);ä¸ºä»€ä¹ˆä¼šå¼ºè°ƒè¿™ä¸ªæ–¹æ³•å‘¢ï¼Ÿæ¥ï¼Œçœ‹ä»£ç ï¼</p>

<p><img src="/img/recursion/circular/circular10.png" alt="ä»£ç è°ƒè¯•" title="ä»£ç è°ƒè¯•" /></p>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬å°¤ä¸ºå…³æ³¨çš„å¯èƒ½å°±æ˜¯è¿™ä¸ªæ–¹æ³•ä¸­çš„this.singletonObjects.put(beanName, singletonObject);
å¯¹äºsetæ–¹å¼æ³¨å…¥ï¼Œå› ä¸ºåœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–Dçš„æ—¶å€™ï¼Œå°±å·²ç»æŠŠDå¯¹è±¡æ”¾å…¥äº†singletonObjectsä¸­ï¼Œé‚£ä¹ˆå½“Eå†è·å–Dçš„æ—¶å€™ï¼Œ
é€šè¿‡getSingletonæ–¹æ³•å°±å¯ä»¥å–åˆ°äº†ï¼ç„¶è€Œå¯¹äºé€šè¿‡æ„é€ æ–¹å¼æ³¨å…¥çš„ï¼Œåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å·²ç»å‡ºé”™äº†ï¼Œéƒ½æ²¡æ‰§è¡Œåˆ°è¿™ä¸ªæ–¹æ³•ï¼Œ
å› æ­¤åœ¨getSingletonè·å–åˆ°çš„æ˜¯nullã€‚</p>

<p><small>è¿™ç¯‡åšå®¢åæœŸä¸€å®šä¼šé€æ­¥å®Œå–„ï¼ŒæŠŠä¸æ˜¯é‚£ä¹ˆå®Œå–„çš„å†…å®¹æ”¾å‡ºæ¥çš„åŸå› å°±æ˜¯é€¼ç€è‡ªå·±å»å®Œå–„ï¼ä¸ç„¶æ‹–å»¶ç—‡â€¦..é€¼è‡ªå·±ä¸€æŠŠï¼ï¼ˆä¸‹ä¸€ç¯‡åšå®¢ï¼štx-lcnæºç åˆ†æï¼Œæ·¦ï¼ï¼‰</small></p>

:ET